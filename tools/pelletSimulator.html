---
layout: toolTemplate
title: Pellet Simulator
---
	</head>
	<body>
		<div class="wrapper" id="main">
			<h1>Pellet simulator</h1>
			<div class="container">
				<form id="controls">
					<input name="physics" type="text" value="200">Physics frames per second<br>
					<input name="simSpeed" type="text" value="60">Time per second<br>
					<input name="graphics" type="text" value="10">Physics frames per graphic frame<br>
					Origin of coordinate system<input name="origin" type="radio" value="earth">Earth <input name="origin" type="radio" value="moon" checked> Moon.<br>
					<input name="radius" type="text">Radius (km)<br>
					<input name="argument" type="text" value="0">Argument (degrees)<br>
					<p>Pellet velocity (m/s)</p>
					From: <input name="velocity0" type="text"> to: <input name="velocity1" type="text"><br>
					<input name="pellets" type="number" value="5">Number of pellets<br>
					<input name="direction" value="0">Vector direction (degrees)<br>
				</form>
				<button onclick="simulator.update()">Update form</button>
				<button onclick="simulator.pause()">Pause</button>
			</div>
			<canvas width="1000" height="1000" id="canvas"></canvas>
		</div>
		<script>
String.prototype.hashCode = function(){
	var hash = 0, i, chr;
	if(this.length === 0) return hash;
	for(i = 0; i < this.length; i++){
		chr = this.charCodeAt(i);
		hash = ((hash << 5) - hash) + chr;
		hash |= 0;
	};
	return hash;
};
var simulator = {
	init : function(){
		this.canvas = document.getElementById("canvas");
		this.ctx = this.canvas.getContext("2d");
	},
	physics : {
		params : {},
		state : {},
		step : function(state){
			for(var i=0;i<state.pellets.length;i++){
				state.pellets[i].x += state.pellets[i].vx * state.deltaTime;
				state.pellets[i].y += state.pellets[i].vy * state.deltaTime;
			};
			return state;
		},
	},
	mPerPx : 1000000,
	draw : function(state){
		var ctx = this.ctx;
		ctx.clearRect(0,0,this.canvas.width,this.canvas.height);
		ctx.fillStyle = "black";
		ctx.fillRect(0,0,this.canvas.width,this.canvas.height);
		ctx.beginPath();
		ctx.fillStyle = "blue";
		ctx.arc(this.canvas.width/2,this.canvas.height/2,6378000/this.mPerPx,0,2*Math.PI);//earth
		ctx.fill();
		ctx.beginPath();
		ctx.fillStyle = "grey";
		ctx.arc(
			this.canvas.width/2 + (384400000/this.mPerPx)*Math.cos(2*Math.PI*this.physics.params.time/(27.321661*86400)),
			this.canvas.height/2 - (384400000/this.mPerPx)*Math.sin(2*Math.PI*this.physics.params.time/(27.321661*86400)),
			1738000/this.mPerPx,0,2*Math.PI);//moon
		ctx.fill();
		ctx.fillStyle = "red";
		var pellets = this.physics.state.pellets;
		for(var i=0;i<pellets.length;i++){
			ctx.beginPath();
			ctx.arc(this.canvas.width/2 + pellets[i].x/this.mPerPx,this.canvas.height/2 + pellets[i].y/this.mPerPx,3,0,2*Math.PI);
			ctx.fill();
		};
	},
	update : function(){
		var form = document.getElementById("controls");
		form.find = function(field){
			return Number(this.elements[field].value);
		};

		var params = {};
		params.fps = Math.floor(
			form.find("graphics") * 1000 / form.find("physics")
		);
		params.deltaTime = Math.floor(
			form.find("physics") / form.find("graphics")
		) * form.find("graphics") * form.find("simSpeed");
		params.simSpeed = form.find("simSpeed");
		pellets = [];
		params.velocity0 = form.find("velocity0");
		params.velocity1 = form.find("velocity1");
		params.direction = Math.PI * form.find("direction")/180;
		params.radius = form.find("radius");
		params.argument = Math.PI * form.find("argument")/180;
		params.time = 0;
		if(form.origin.value === "earth"){
			x = Math.cos(params.argument) * params.radius;
		}
		else{
			x = Math.cos(params.argument) * params.radius + 384400000;
		};
		var y = Math.sin(params.argument) * params.radius;
		for(var i = 0;i < form.find("pellets");i++){
			var pellet = {};
			var velocity = params.velocity0 + (params.velocity1 - params.velocity0) * i/(form.find("pellets")-1);
			pellet.vx = Math.cos(params.direction + params.argument) * velocity;
			pellet.vx = Math.sin(params.direction + params.argument) * velocity;
			pellet.y = y;
			pellet.x = x;
			//oldPosu.push([x,y]);
			pellets.push(pellet);
		};
		this.physics.state.pellets = pellets;
		this.physics.params = params;
		this.loop = function(){
			this.physics.state = this.physics.step(this.physics.state);
			this.physics.params.time += this.physics.params.simSpeed/this.physics.params.fps;
			this.draw(this.physicsState);
		};
		this.loopID = setInterval(
			function(){
				simulator.loop()
			},
			this.physics.params.fps
		)
	},
	pause : function(){
		clearInterval(this.loopID);
	},
	unpause : function(){
		this.loopID = setInterval(
			function(){
				simulator.loop()
			},
			this.physics.params.fps
		)
	}
};
simulator.init();
		</script>
